<!DOCTYPE html>
<html lang="en">

  <!-- Head -->
  <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">    <!-- Metadata, OpenGraph and Schema.org -->
    

    <!-- Standard metadata -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Mirrascope Ray Tracing | Thomas Samir Bsaibes</title>
    <meta name="author" content="Thomas Samir Bsaibes">
    <meta name="description" content="Calculating the ray tracing of a mirrascope.">


    <!-- Bootstrap & MDB -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous">

    <!-- Bootstrap Table -->
    <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons">

    <!-- Code Syntax Highlighting -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light">

    

    <!-- Styles -->
    
    <link rel="shortcut icon" href="/assets/img/clover.png">
    
    <link rel="stylesheet" href="/assets/css/main.css">
    <link rel="canonical" href="https://thomasbsaibes.github.io/projects/8_project/">

    <!-- Dark Mode -->
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark">

    <script src="/assets/js/theme.js"></script>
    <script src="/assets/js/dark_mode.js"></script>
    

  </head>

  <!-- Body -->
  <body class="fixed-top-nav ">

    <!-- Header -->
    <header>

      <!-- Nav Bar -->
      <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top">
        <div class="container">
          <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">Thomas </span>Samir Bsaibes</a>
          <!-- Navbar Toggle -->
          <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar top-bar"></span>
            <span class="icon-bar middle-bar"></span>
            <span class="icon-bar bottom-bar"></span>
          </button>

          <div class="collapse navbar-collapse text-right" id="navbarNav">
            <ul class="navbar-nav ml-auto flex-nowrap">

              <!-- About -->
              <li class="nav-item ">
                <a class="nav-link" href="/">about</a>
              </li>
              

              <!-- Other pages -->
              <li class="nav-item ">
                <a class="nav-link" href="/publications/">publications</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/projects/">projects</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/cv/">cv</a>
              </li>
              <li class="nav-item ">
                <a class="nav-link" href="/links/">links</a>
              </li>
              <li class="nav-item dropdown ">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown">
                  <a class="dropdown-item" href="/publications/">publications</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="/projects/">projects</a>
                </div>
              </li>

              <!-- Toogle theme mode -->
              <li class="toggle-container">
                <button id="light-toggle" title="Change theme">
                  <i class="fas fa-moon"></i>
                  <i class="fas fa-sun"></i>
                </button>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Scrolling Progress Bar -->
      <progress id="progress" value="0">
        <div class="progress-container">
          <span class="progress-bar"></span>
        </div>
      </progress>
    </header>


    <!-- Content -->
    <div class="container mt-5">
      
        <!-- page.html -->
        <div class="post">

          <header class="post-header">
            <h1 class="post-title">Mirrascope Ray Tracing</h1>
            <p class="post-description">Calculating the ray tracing of a mirrascope.</p>
          </header>

          <article>
            <!-- <iframe
  src="https://github.com/BsaibesT/bsaibest.github.io/blob/master/assets/notebooks/ParabolicMirrorSim_v2.html?kernel=python&toolbar=1"
  width="100%"
  height="500px"
>
</iframe> -->

<!-- <script src="https://unpkg.com/thebe@latest/lib/index.js"></script>

<script type="text/x-thebe-config">
{
    requestKernel: true,
    kernelOptions: {
      kernelName: "python3",
      path: "bsaibest.github.io/assets/notebooks/"
    }
    binderOptions: {
        repo: "binder-examples/requirements",
        ref: "master",
    },
}
</script> -->

<!-- Configure and load Thebe !-->
<!-- <script type="text/x-thebe-config">
  {
      requestKernel: true,
      mountActivateWidget: true,
      mountStatusWidget: true,
      binderOptions: {
      repo: "binder-examples/requirements",
      },
  }
</script>

<script src="https://unpkg.com/thebe@latest/lib/index.js"></script>

<div class="thebe-activate"></div>
<div class="thebe-status"></div>

<pre data-executable="true" data-language="python">print("Hello!")</pre> -->

<h1 id="underlinetext3d-parabolic-mirror-raytracing-simulation">$\underline{\text{3D parabolic mirror raytracing simulation}}$</h1>

<h2 id="underlinetextimport-statement">$\underline{\text{Import statement}}$</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span> <span class="n">matplotlib.widgets</span> <span class="kn">import</span> <span class="n">Slider</span><span class="p">,</span> <span class="n">Button</span>
<span class="kn">from</span> <span class="n">ipywidgets</span> <span class="kn">import</span> <span class="n">interact</span><span class="p">,</span> <span class="n">interactive</span>
<span class="kn">from</span> <span class="n">tqdm</span> <span class="kn">import</span> <span class="n">tqdm</span>
<span class="kn">import</span> <span class="n">ipywidgets</span> <span class="k">as</span> <span class="n">widgets</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
</code></pre></div></div>

<h2 id="underlinetextthe-parabolic-surfaces">$\underline{\text{The parabolic surfaces.}}$</h2>

<h3 id="the-line-of-intersection-of-the-two-mirrors">The line of intersection of the two mirrors.</h3>

<p>The function for the two parabolic surfaces.
\begin{align}
&amp;f_{bottom\ mirror} = ax^2 + by^2 \tag{1}<br>
&amp;f_{top\ mirror} = \alpha x^2 + \beta y^2 + d \tag{2}
\end{align}
where $a$ and $b$ are constants. $f_{bottom\ mirror}$ and $f_{\top mirror}$ will be denoted as $f_{bm}$ and $f_{tm}$ respectively.</p>

<p>The line of intersection of the top mirror and bottom mirror is given by the following
\begin{align}
f_{bm} &amp;= f_{tm}<br>
ax^2 + by^2 &amp;= \alpha x^2 + \beta y^2 + d<br>
(a-\alpha)x^2 &amp;+ (b-\beta)y^2 = d<br>
\left(\frac{a-\alpha}{d}\right)x^2 &amp;+ \left(\frac{b-\beta}{d}\right)y^2 = 1<br>
\left(\frac{x}{\gamma}\right)^2 &amp;+ \left(\frac{y}{\eta}\right)^2 = 1 \tag{3}
\end{align}
where $\gamma^2 = d/(a - \alpha)$ and $\eta^2 = d/(b - \beta)$
Given a range of $x$, the range of $y$ is given by
$y = \pm\sqrt{\eta^2-\frac{\eta^2x^2}{\gamma^2}}\tag{4}$</p>

<h3 id="calculate-the-surface-normal">Calculate the surface normal</h3>

<p>The gradient of the surface
\begin{align}
\vec{\nabla}f(x,y) = \partial_xf(x,y)\hat{x} + \partial_yf(x,y)\hat{y}\tag{5} <br>
\vec{\nabla}f(x,y) = 2\alpha x\hat{x} + 2\beta y\hat{y}\tag{6}
\end{align}
where $\alpha$ and $\beta$ is either $\pm a$ or $\pm b$ depending on which mirror is being described.</p>

<p>Let
\begin{equation}
\vec{v_x} =
\begin{pmatrix}
1\0\m_x
\end{pmatrix}
\vec{v_y} =
\begin{pmatrix}
0\1\m_y
\end{pmatrix} \tag{7}
\end{equation}
and
\begin{equation}
m_x = 2\alpha x\ \ \ m_y = 2\beta y\tag{8}
\end{equation}</p>

<p>The normal of the surface is given by
\begin{equation}
\hat{n} = \frac{\vec{v_x}\times\vec{v_y}}{\left|\vec{v_x}\times\vec{v_y}\right|} \tag{9}
\end{equation}</p>

<p>\begin{equation}
\hat{n} = \frac{-(2\alpha x\hat{x} + 2\beta y\hat{y} -1\hat{z})}{\sqrt{(2\alpha x)^2+)2\beta y)^2 + (1)^2}} \tag{10}
\end{equation}</p>

<h3 id="the-angle-between-an-incident-vector-and-a-surface-normal-vector">The angle between an incident vector and a surface normal vector</h3>

<p>The angle between $\hat{n}$ and the incident beam $\hat{I}$ is given by
\begin{equation}
\phi = \cos^{-1}\left(\frac{\hat{n}\cdot\hat{I}}{|\hat{n}||\hat{I}|}\right)\tag{11}
\end{equation}</p>

<h3 id="calculating-the-reflection-vector">Calculating the reflection vector</h3>

<p>First calculate vector perpendicular to both $\hat{I}$ and $\hat{n}$,</p>

<p>$\hat{u} = \hat{I}\times\hat{n}\tag{12}$</p>

<p>Then calculate a vector perpendicular to $\hat{u}$ and in the same plane as $\hat{n}$</p>

<p>$\hat{e} = \hat{n}\times\hat{u}\tag{13}$</p>

<p>Then write the incident angle in the $\hat{e}$, $\hat{n}$ bases.</p>

<p>$\hat{I} = \left(\hat{I}\cdot\hat{n}\right)\hat{n} + \left(\hat{I}\cdot\hat{e}\right)\hat{e} \tag{14}$</p>

<p>Reflection vector
$\hat{R} = \cos(-\varphi)\hat{n} + \sin(-\varphi)\hat{e} \tag{15}$</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Parablic surface
</span><span class="k">def</span> <span class="nf">parabolic_surf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">beta</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
  <span class="n">tm</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">beta</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">offset</span>
  <span class="n">bm</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">surfaces</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">top mirror</span><span class="sh">'</span><span class="p">:</span> <span class="n">tm</span><span class="p">,</span><span class="sh">'</span><span class="s">bottom mirror</span><span class="sh">'</span><span class="p">:</span> <span class="n">bm</span><span class="p">}</span>
  <span class="k">return</span> <span class="n">surfaces</span>

<span class="c1"># Calculates the normal at a given x and y
</span><span class="k">def</span> <span class="nf">parabolic_surf_normal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="n">mx</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">x</span>
  <span class="n">my</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">y</span>
  <span class="n">vx</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">mx</span><span class="p">])</span>
  <span class="n">vy</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">my</span><span class="p">])</span>
  <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">cross</span><span class="p">(</span><span class="n">vx</span><span class="p">,</span><span class="n">vy</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">n</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="c1"># Calculates incident angle
</span><span class="k">def</span> <span class="nf">incident_angle</span><span class="p">(</span><span class="n">normal_vector</span><span class="p">,</span><span class="n">incident_vector</span><span class="p">):</span>
  <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arccos</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">normal_vector</span><span class="p">,</span><span class="n">incident_vector</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">angle</span>

<span class="c1"># Reflection vector
</span><span class="k">def</span> <span class="nf">reflection_vector</span><span class="p">(</span><span class="n">normal_vector</span><span class="p">,</span><span class="n">incident_vector</span><span class="p">):</span>
  <span class="n">angle</span> <span class="o">=</span> <span class="nf">incident_angle</span><span class="p">(</span><span class="n">normal_vector</span><span class="p">,</span><span class="n">incident_vector</span><span class="p">)</span>
  <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">cross</span><span class="p">(</span><span class="n">incident_vector</span><span class="p">,</span><span class="n">normal_vector</span><span class="p">)</span>
  <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
  <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">cross</span><span class="p">(</span><span class="n">normal_vector</span><span class="p">,</span><span class="n">u</span><span class="p">)</span>
  <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
  <span class="n">reflection</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="o">-</span><span class="n">angle</span><span class="p">)</span><span class="o">*</span><span class="n">normal_vector</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="o">-</span><span class="n">angle</span><span class="p">)</span><span class="o">*</span><span class="n">e</span>
  <span class="k">return</span> <span class="n">reflection</span>

<span class="c1"># Mirror line of intersection
</span><span class="k">def</span> <span class="nf">intersection_range</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">beta</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
  <span class="n">gamma_sq</span> <span class="o">=</span> <span class="n">offset</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">-</span><span class="n">alpha</span><span class="p">)</span>
  <span class="n">eta_sq</span> <span class="o">=</span> <span class="n">offset</span><span class="o">/</span><span class="p">(</span><span class="n">b</span><span class="o">-</span><span class="n">beta</span><span class="p">)</span>
  <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">eta_sq</span> <span class="o">-</span> <span class="p">(</span><span class="n">eta_sq</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">gamma_sq</span> <span class="o">+</span> <span class="mf">0j</span><span class="p">)</span>
  <span class="n">ymax</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">eta_sq</span><span class="o">-</span> <span class="p">(</span><span class="n">eta_sq</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">xmax</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="n">gamma_sq</span> <span class="o">+</span> <span class="mf">0j</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">ymin</span><span class="p">),</span><span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">ymax</span><span class="p">),</span><span class="n">eta_sq</span><span class="p">,</span><span class="n">gamma_sq</span>

<span class="k">def</span> <span class="nf">intersection</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">beta</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">):</span>
  <span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">,</span><span class="n">eta_sq</span><span class="p">,</span><span class="n">gamma_sq</span> <span class="o">=</span> <span class="nf">intersection_range</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">alpha</span><span class="p">,</span><span class="n">beta</span><span class="p">,</span><span class="n">offset</span><span class="p">)</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="p">:</span><span class="mf">1000j</span><span class="p">]</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">gamma_sq</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">eta_sq</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
  <span class="n">z</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">zp</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">beta</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">d</span>
  <span class="k">return</span> <span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">z</span><span class="p">),</span><span class="n">np</span><span class="p">.</span><span class="nf">real</span><span class="p">(</span><span class="n">zp</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="underlinetexttest-variables">$\underline{\text{Test Variables}}$</h3>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">## Test Variables ##
</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span> <span class="o">=</span> <span class="mf">0.31983</span><span class="p">,</span> <span class="mf">0.78643</span>               <span class="c1">#..................... Initial incident location
</span><span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span>                         <span class="c1">#..................... Parabolic constants
</span><span class="n">d</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">4</span><span class="o">*</span><span class="n">a</span><span class="p">)</span>                            <span class="c1">#..................... Offset for the top mirror
</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>                  <span class="c1">#..................... Initial incident vector
</span><span class="n">n</span> <span class="o">=</span> <span class="nf">parabolic_surf_normal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">)</span>   <span class="c1">#..................... Normal vector
</span><span class="n">R</span> <span class="o">=</span> <span class="nf">reflection_vector</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>             <span class="c1">#..................... Reflection vector
</span>
<span class="n">theta_nI</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arccos</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">I</span><span class="p">))</span>
<span class="n">theta_nR</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arccos</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">R</span><span class="p">))</span>

<span class="n">z0</span> <span class="o">=</span> <span class="nf">parabolic_surf</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">d</span><span class="p">)[</span><span class="sh">'</span><span class="s">bottom mirror</span><span class="sh">'</span><span class="p">]</span>

<span class="n">Pi</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">z0</span><span class="p">])</span>              <span class="c1">#..................... Initial incident point on bottom mirror
</span>
<span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">xmax</span> <span class="o">=</span>  <span class="mi">1</span>
<span class="n">mirror_intersect_x</span><span class="p">,</span><span class="n">mirror_intersect_y</span><span class="p">,</span><span class="n">mirror_intersect_z</span><span class="p">,</span><span class="n">mirror_intersect_zp</span> <span class="o">=</span> <span class="nf">intersection</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>

<span class="n">xrange_min</span> <span class="o">=</span> <span class="n">mirror_intersect_x</span><span class="p">.</span><span class="nf">min</span><span class="p">()</span>
<span class="n">xrange_max</span> <span class="o">=</span> <span class="n">mirror_intersect_x</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span>

<span class="n">yrange_min</span> <span class="o">=</span> <span class="n">mirror_intersect_y</span><span class="p">.</span><span class="nf">min</span><span class="p">()</span>
<span class="n">yrange_max</span> <span class="o">=</span> <span class="n">mirror_intersect_y</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span>

<span class="n">zrange_min</span> <span class="o">=</span> <span class="n">mirror_intersect_z</span><span class="p">.</span><span class="nf">min</span><span class="p">()</span>
<span class="n">zrange_max</span> <span class="o">=</span> <span class="n">mirror_intersect_z</span><span class="p">.</span><span class="nf">max</span><span class="p">()</span>

<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">xrange_min</span><span class="p">:</span><span class="n">xrange_max</span><span class="p">:</span><span class="mf">500j</span><span class="p">,</span><span class="n">yrange_min</span><span class="p">:</span><span class="n">yrange_max</span><span class="p">:</span><span class="mf">500j</span><span class="p">]</span>
<span class="n">out_of_bounds</span> <span class="o">=</span> <span class="nf">pow</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nf">pow</span><span class="p">(</span><span class="n">xrange_max</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="nf">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">y</span><span class="p">[</span><span class="n">out_of_bounds</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="n">NaN</span>

<span class="n">mirror_surfaces</span> <span class="o">=</span> <span class="nf">parabolic_surf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">d</span><span class="p">)</span><span class="c1">#.................... Mirror surfaces
</span><span class="n">tm_surf</span> <span class="o">=</span> <span class="n">mirror_surfaces</span><span class="p">[</span><span class="sh">'</span><span class="s">top mirror</span><span class="sh">'</span><span class="p">]</span>
<span class="n">bm_surf</span> <span class="o">=</span> <span class="n">mirror_surfaces</span><span class="p">[</span><span class="sh">'</span><span class="s">bottom mirror</span><span class="sh">'</span><span class="p">]</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">5.5</span><span class="p">,</span><span class="mf">5.5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="sh">'</span><span class="s">3d</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tm_surf</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">viridis_r</span><span class="sh">'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="sh">'</span><span class="s">none</span><span class="sh">'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bm_surf</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">viridis</span><span class="sh">'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="sh">'</span><span class="s">none</span><span class="sh">'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot3D</span><span class="p">(</span><span class="n">mirror_intersect_x</span><span class="p">,</span><span class="n">mirror_intersect_y</span><span class="p">,</span><span class="n">mirror_intersect_z</span> <span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">purple</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">axis</span><span class="p">(</span><span class="sh">'</span><span class="s">equal</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># plt.xlim([-1,1])
# plt.ylim([-1,1])
# ax.set_zlim(0,1)
</span><span class="n">ax</span><span class="p">.</span><span class="nf">set_zlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">z</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_proj_type</span><span class="p">(</span><span class="sh">'</span><span class="s">ortho</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="mf">00.0</span><span class="p">,</span> <span class="n">azim</span><span class="o">=-</span><span class="mf">90.0</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Mirror Surfaces</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="ParabolicMirrorSim_v2_files/ParabolicMirrorSim_v2_15_0.png" alt="png"></p>

<h2 id="underlinetextcalculating-the-proceeding-incident-points">$\underline{\text{Calculating the proceeding incident points.}}$</h2>

<h3 id="line-along-direction-of-reflection">Line along direction of reflection</h3>

<p>A line along the reflected
$\vec{L} = \vec{P_I} + c\hat{R}\tag{16}$
where $\vec{P_I}$ is a point of on one of the mirrors, $\hat{R}$ is a normal vector along the direction of reflection, and $c$ is a scaling constant. The direction of $\hat{R}$ will determine if the reflection beam will go up to reflect off the top mirror or reflect again off the bottom mirror.</p>

<p>By determining $c$ in Eq. 16, the proceeding incident point can be determined. However, there are four senarios:</p>

<ol>
  <li>Intersection with the bottom mirror from a bottom mirror reflection</li>
  <li>Intersection with the top mirror from a bottom mirror reflection</li>
  <li>Intersection with the bottom mirror from a top mirror reflection</li>
  <li>Intersection with the top mirror from a top mirror reflection</li>
</ol>

<h3 id="intersection-with-the-bottom-mirror-from-bottom-mirror-reflection">Intersection with the bottom mirror from bottom mirror reflection.</h3>

<p>Computing $c$ for an intersection with the bottom mirror from a bottom mirror reflection.</p>

<p>$\underline{\text{bottom mirror:}}$ $f_{bm}(x,y) = ax^2+by^2$</p>

<p>$\underline{\text{Line of reflection:}}$ $\vec{L} = \vec{P_I}+c\hat{R}$</p>

<p>$\underline{\text{Point of intersection:}}$ $\vec{P_1} = \begin{pmatrix}x_1\y_1\f_{bm}(x_1,y_1)\end{pmatrix}$</p>

<p>$\begin{pmatrix}x_1\y_1\f_{bm}(x_1,y_1)\end{pmatrix} = \begin{pmatrix}x\y\f_{bm}(x,y)\end{pmatrix} + c\begin{pmatrix}R_x\R_y\R_z\end{pmatrix}\tag{17}$</p>

<p>$x_1 = x+ cR_x\tag{18}$
$y_1 = y + cR_y\tag{19}$
$f_{bm}(x_1,y_1) = f_{bm}(x,y) + cR_z \tag{20}$</p>

<p>Substituting Eqs. 18 and 19 into 20 $c$ can be solved for.
\begin{align}
ax_1^2 + by_1^2 &amp;= ax^2 + by^2 + cR_z<br>
a(x + cR_x)^2 + b(y+cR_y)^2 &amp;= ax^2 + by^2 + cR_z<br>
a(x^2 + (cR_x)^2 + 2xcR_x) + b(y^2 + (cR_y)^2 + 2ycR_y) &amp;= ax^2 + by^2 + cR_z<br>
ac^2R_x^2 + 2axcR_x + bc^2R_y^2 + 2bycR_y &amp;=  cR_z<br>
acR_x^2 + 2axR_x + bcR_y^2 + 2byR_y &amp;=  R_z<br>
c(aR_x^2 + bR_y^2)  &amp;=  R_z - (2axR_x + 2byR_y)<br>
\end{align}</p>

<p>$c = \frac{R_z-2(axR_x+byR_y)}{aR_x^2+bR_y^2} \tag{21}$</p>

<h3 id="intersection-with-top-mirror-from-bottom-mirror-reflection">Intersection with top mirror from bottom mirror reflection</h3>

<p>Computing $c$ for an intersection with the top mirror from a bottom mirror reflection.</p>

<p>$\underline{\text{bottom mirror:}}$ $f_{bm}(x,y) = ax^2+by^2$</p>

<p>$\underline{\text{top mirror:}}$ $f_{tm}(x,y) = \alpha x^2+\beta y^2 + d$</p>

<p>$\underline{\text{Line of reflection:}}$ $\vec{L} = \vec{P_I}+c\hat{R}$</p>

<p>$\underline{\text{Point of intersection:}}$ $\vec{P_1} = \begin{pmatrix}x_1\y_1\f_{tm}(x_1,y_1)\end{pmatrix}$</p>

<p>$
\begin{pmatrix}
x_1\y_1\f_{tm}(x_1,y_1)\end{pmatrix} = \begin{pmatrix}x\y\f_{bm}(x,y)\end{pmatrix} + c\begin{pmatrix}R_x\R_y\R_z
\end{pmatrix}\tag{22}
$</p>

<p>$x_1 = x+ cR_x\tag{23}$
$y_1 = y + cR_y\tag{24}$
$f_{tm}(x_1,y_1) = f_{bm}(x,y) + cR_z \tag{25}$</p>

<p>Substituting Eqs. 23 and 24 into 25 $c$ can be solved for.
\begin{align}
\alpha(x+cR_x)^2+\beta(y+cR_y)+d &amp;= ax^2+by^2 + cR_z<br>
\alpha(x^2+c^2R_x^2+2xcR_x)+\beta(y^2+c^2R_y^2+2ycR_y)+d &amp;= ax^2+by^2 + cR_z<br>
c^2(\alpha R_x^2+\beta R_y^2)+c(2\alpha xR_x+2\beta yR_y-R_z)+d &amp;= (a-\alpha)x^2 + (b-\beta)y^2<br>
c^2(\alpha R_x^2+\beta R_y^2)+c(2\alpha xR_x+2\beta yR_y-R_z)+ d &amp;-(a-\alpha)x^2 - (b-\beta)y^2 = 0<br>
\end{align}
Set
\begin{align}A &amp;= \alpha R_x^2 + \beta R_y^2\B&amp;=2\alpha xR_x+2\beta yR_y - R_z\\Gamma &amp;= d - (a-\alpha)x^2 - (b-\beta)y^2<br>
Ac^2 &amp;+ Bc + \Gamma = 0
\end{align}
<br>
$
c = \left{\begin{matrix}
\frac{1}{2A}\left(-B\pm\sqrt{B^2-4A\Gamma}\right) &amp; ;A\neq0<br>
\frac{-\Gamma}{B} &amp; ;A = 0
\end{matrix}\right.
\tag{26}
$</p>

<h3 id="intersection-with-bottom-mirror-from-a-top-mirror-reflection">Intersection with bottom mirror from a top mirror reflection.</h3>

<p>Computing $c$ for an intersection with the bottom mirror from a top mirror reflection.</p>

<p>$\underline{\text{bottom mirror:}}$ $f_{bm}(x,y) = ax^2+by^2$</p>

<p>$\underline{\text{top mirror:}}$ $f_{tm}(x,y) = \alpha x^2+\beta y^2 + d$</p>

<p>$\underline{\text{Line of reflection:}}$ $\vec{L} = \vec{P_I}+c\hat{R}$</p>

<p>$\underline{\text{Point of intersection:}}$ $\vec{P_1} = \begin{pmatrix}x_1\y_1\f_{bm}(x_1,y_1)\end{pmatrix}$</p>

<p>$
\begin{pmatrix}
x_1\y_1\f_{bm}(x_1,y_1)\end{pmatrix} = \begin{pmatrix}x\y\f_{tm}(x,y)\end{pmatrix} + c\begin{pmatrix}R_x\R_y\R_z
\end{pmatrix}\tag{27}
$</p>

<p>$x_1 = x+ cR_x\tag{28}$
$y_1 = y + cR_y\tag{29}$
$f_{bm}(x_1,y_1) = f_{tm}(x,y) + cR_z \tag{30}$</p>

<p>Substituting Eqs. 28 and 29 into 30 $c$ can be solved for.
\begin{align}
a(x+cR_x)^2+b(y+cR_y) &amp;= \alpha x^2+\beta y^2 + d + cR_z<br>
a(x^2+c^2R_x^2+2xcR_x)+b(y^2+c^2R_y^2+2ycR_y) &amp;= \alpha x^2+\beta y^2 + d + cR_z<br>
c^2(a R_x^2+b R_y^2)+c(2axR_x+2byR_y-R_z)&amp;= (\alpha-a)x^2 + (\beta-b)y^2 + d<br>
c^2(a R_x^2+b R_y^2)+c(2a xR_x+2b yR_y-R_z) &amp;- (\alpha-a)x^2 - (\beta-b)y^2 - d = 0
\end{align}</p>

<p>Set
\begin{align}
A’ &amp;= a R_x^2 + b R_y^2\B’&amp;=2a xR_x+2b yR_y - R_z\\Gamma’ &amp;= -d - (a-\alpha)x^2 - (b-\beta)y^2<br>
A’c^2 &amp;+ B’c + \Gamma’ = 0
\end{align}
<br>
$
c = \left{\begin{matrix}
\frac{1}{2A’}\left(-B’\pm\sqrt{B’^2-4A’\Gamma’}\right) &amp; ;A\neq0<br>
\frac{-\Gamma’}{B’} &amp; ;A = 0
\end{matrix}\right.
\tag{31}
$</p>

<h3 id="intersection-with-top-mirror-from-a-top-mirror-reflection">Intersection with top mirror from a top mirror reflection.</h3>

<p>Computing $c$ for an intersection with the top mirror from a top mirror reflection.</p>

<p>$\underline{\text{top mirror:}}$ $f_{tm}(x,y) = \alpha x^2+\beta y^2 + d$</p>

<p>$\underline{\text{Line of reflection:}}$ $\vec{L} = \vec{P_I}+c\hat{R}$</p>

<p>$\underline{\text{Point of intersection:}}$ $\vec{P_1} = \begin{pmatrix}x_1\y_1\f_{tm}(x_1,y_1)\end{pmatrix}$</p>

<p>$\begin{pmatrix}x_1\y_1\f_{tm}(x_1,y_1)\end{pmatrix} = \begin{pmatrix}x\y\f_{tm}(x,y)\end{pmatrix} + c\begin{pmatrix}R_x\R_y\R_z\end{pmatrix}\tag{32}$</p>

<p>$x_1 = x+ cR_x\tag{33}$
$y_1 = y + cR_y\tag{34}$
$f_{tm}(x_1,y_1) = f_{tm}(x,y) + cR_z \tag{35}$</p>

<p>Substituting Eqs. 18 and 19 into 20 $c$ can be solved for.
\begin{align}
\alpha x_1^2 + \beta y_1^2 + d &amp;= \alpha x^2 + \beta y^2 + d + cR_z<br>
\alpha(x+cR_x)^2 + \beta(y+cR_y)^2 &amp;= \alpha x^2 + \beta y^2 + cR_z<br>
\alpha(x^2+c^2R_x^2+2xcR_x) + \beta(y^2+c^2R_y^2+2ycR_y) &amp;= \alpha x^2 + \beta y^2 + cR_z<br>
c^2(\alpha R_x^2+\beta R_y^2)+c(2\alpha xR_x + 2\beta ycR_y) &amp;= cR_z
\end{align}</p>

<p>$c = \frac{R_z-2(\alpha xR_x+\beta yR_y)}{\alpha R_x^2+\beta R_y^2} \tag{36}$</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">scale_factor</span><span class="p">(</span><span class="n">reflectionVector</span><span class="p">,</span><span class="n">initial_point</span><span class="p">,</span><span class="n">mirror_intersection_z</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">alpha</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">beta</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span><span class="n">offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,):</span>
  <span class="c1">## Cacluates the scaling factor to determine the next point of incident.
</span>  <span class="n">Rx</span> <span class="o">=</span> <span class="n">reflectionVector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">Ry</span> <span class="o">=</span> <span class="n">reflectionVector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">Rz</span> <span class="o">=</span> <span class="n">reflectionVector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

  <span class="n">initial_x</span> <span class="o">=</span> <span class="n">initial_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">initial_y</span> <span class="o">=</span> <span class="n">initial_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">initial_z</span> <span class="o">=</span> <span class="n">initial_point</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">polar_angle</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arccos</span><span class="p">(</span><span class="n">Rz</span><span class="o">/</span><span class="n">np</span><span class="p">.</span><span class="n">linalg</span><span class="p">.</span><span class="nf">norm</span><span class="p">(</span><span class="n">reflectionVector</span><span class="p">))</span>

  <span class="k">if</span> <span class="n">initial_z</span> <span class="o">&lt;</span> <span class="n">mirror_intersection_z</span> <span class="ow">and</span> <span class="n">polar_angle</span> <span class="o">&lt;</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
    <span class="c1"># print('Up reflection from bottom mirror')
</span>    <span class="n">A</span> <span class="o">=</span> <span class="n">alpha</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">Rx</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">beta</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">Ry</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">B</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">alpha</span><span class="o">*</span><span class="n">initial_x</span><span class="o">*</span><span class="n">Rx</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">beta</span><span class="o">*</span><span class="n">initial_y</span><span class="o">*</span><span class="n">Ry</span> <span class="o">-</span> <span class="n">Rz</span>
    <span class="n">Gamma</span> <span class="o">=</span> <span class="n">d</span> <span class="o">-</span> <span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">initial_x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">beta</span><span class="p">)</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">initial_y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="nf">bool</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="c1"># Prevents problems if A = 0
</span>      <span class="n">c_bottom_top_1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">pow</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">Gamma</span><span class="p">))</span>
      <span class="n">c_bottom_top_2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">A</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">B</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">pow</span><span class="p">(</span><span class="n">B</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">A</span><span class="o">*</span><span class="n">Gamma</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">c_bottom_top_1</span> <span class="o">=</span> <span class="n">c_bottom_top_2</span> <span class="o">=</span> <span class="o">-</span><span class="n">Gamma</span><span class="o">/</span><span class="n">B</span>

    <span class="n">c_bottom_bottom</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rz</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">initial_x</span><span class="o">*</span><span class="n">Rx</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">initial_y</span><span class="o">*</span><span class="n">Ry</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">Rx</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">Ry</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_bottom_top_1</span><span class="p">,</span><span class="n">c_bottom_top_2</span><span class="p">,</span><span class="n">c_bottom_bottom</span><span class="p">]</span>

  <span class="k">elif</span> <span class="n">initial_z</span> <span class="o">&lt;</span> <span class="n">mirror_intersection_z</span> <span class="ow">and</span> <span class="n">polar_angle</span> <span class="o">&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
    <span class="c1"># print('Down reflection from bottom mirror')
</span>    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rz</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">initial_x</span><span class="o">*</span><span class="n">Rx</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="n">initial_y</span><span class="o">*</span><span class="n">Ry</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">Rx</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">b</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">Ry</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>

  <span class="k">elif</span> <span class="n">initial_z</span> <span class="o">&gt;</span> <span class="n">mirror_intersection_z</span> <span class="ow">and</span> <span class="n">polar_angle</span> <span class="o">&gt;</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
    <span class="c1"># print('Down reflection from top mirror')
</span>    <span class="n">Ap</span> <span class="o">=</span> <span class="n">a</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">Rx</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">b</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">Ry</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">Bp</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">initial_x</span><span class="o">*</span><span class="n">Rx</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="n">initial_y</span><span class="o">*</span><span class="n">Ry</span> <span class="o">-</span> <span class="n">Rz</span>
    <span class="n">Gammap</span> <span class="o">=</span> <span class="o">-</span><span class="n">d</span> <span class="o">-</span> <span class="p">(</span><span class="n">alpha</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">initial_x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">beta</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">initial_y</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="nf">bool</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">Ap</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> <span class="c1"># Prevents problems if Ap = 0
</span>      <span class="n">c_top_bottom_1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Ap</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">Bp</span> <span class="o">+</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">pow</span><span class="p">(</span><span class="n">Bp</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">Ap</span><span class="o">*</span><span class="n">Gammap</span><span class="p">))</span>
      <span class="n">c_top_bottom_2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">Ap</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">Bp</span> <span class="o">-</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">pow</span><span class="p">(</span><span class="n">Bp</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mi">4</span><span class="o">*</span><span class="n">Ap</span><span class="o">*</span><span class="n">Gammap</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">c_top_bottom_1</span> <span class="o">=</span> <span class="n">c_top_bottom_2</span> <span class="o">=</span> <span class="o">-</span><span class="n">Gammap</span><span class="o">/</span><span class="n">Bp</span>

    <span class="n">c_top_top</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rz</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">initial_x</span><span class="o">*</span><span class="n">Rx</span> <span class="o">+</span> <span class="n">beta</span><span class="o">*</span><span class="n">initial_y</span><span class="o">*</span><span class="n">Ry</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">Rx</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">beta</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">Ry</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

    <span class="n">scale</span> <span class="o">=</span> <span class="p">[</span><span class="n">c_top_bottom_1</span><span class="p">,</span><span class="n">c_top_bottom_2</span><span class="p">,</span><span class="n">c_top_top</span><span class="p">]</span>

  <span class="k">elif</span> <span class="n">initial_z</span> <span class="o">&gt;</span> <span class="n">mirror_intersection_z</span> <span class="ow">and</span> <span class="n">polar_angle</span> <span class="o">&lt;</span> <span class="n">np</span><span class="p">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
    <span class="c1"># print('Up reflection from top mirror')
</span>    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rz</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">initial_x</span><span class="o">*</span><span class="n">Rx</span> <span class="o">+</span> <span class="n">beta</span><span class="o">*</span><span class="n">initial_y</span><span class="o">*</span><span class="n">Ry</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">Rx</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="n">beta</span><span class="o">*</span><span class="nf">pow</span><span class="p">(</span><span class="n">Ry</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">]</span>

  <span class="k">return</span> <span class="n">scale</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">possible_points</span><span class="p">(</span><span class="n">point</span><span class="p">,</span><span class="n">scale_factor</span><span class="p">,</span><span class="n">reflectionVector</span><span class="p">):</span>
  <span class="c1">## Caluates the possible points from the scaling factor.
</span>  <span class="n">candidates</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">scale_factor</span><span class="p">:</span>
    <span class="n">candidates</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">point</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">reflectionVector</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">candidates</span>

<span class="k">def</span> <span class="nf">next_point_select</span><span class="p">(</span><span class="n">possible_points</span><span class="p">,</span><span class="n">mirror_intersect_x</span><span class="p">,</span><span class="n">mirror_intersect_y</span><span class="p">,</span><span class="n">mirror_intersect_z</span><span class="p">):</span>
  <span class="c1">## Selects the correct point as the next point of incidence.
</span>  <span class="n">check</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">possible_points</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">enumerate</span><span class="p">(</span><span class="n">possible_points</span><span class="p">):</span>
      <span class="n">xycheck</span> <span class="o">=</span> <span class="nf">bool</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">square</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]))</span> <span class="o">&lt;</span> <span class="nf">pow</span><span class="p">(</span><span class="n">mirror_intersect_x</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nf">pow</span><span class="p">(</span><span class="n">mirror_intersect_y</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
      <span class="n">zcheck</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nf">bool</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">mirror_intersect_z</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">zcheck</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">zcheck</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nf">bool</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="nf">mean</span><span class="p">(</span><span class="n">mirror_intersect_z</span><span class="p">))</span>
      <span class="n">check</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">xycheck</span> <span class="o">&amp;</span> <span class="n">zcheck</span><span class="p">)</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">check</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
    <span class="n">next_incident_point</span> <span class="o">=</span> <span class="n">possible_points</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">next_incident_point</span> <span class="o">=</span> <span class="n">possible_points</span>
  <span class="k">return</span> <span class="n">next_incident_point</span>
</code></pre></div></div>

<h2 id="underlinetextpoint-selection">$\underline{\text{Point selection}}.$</h2>

<p>In the case where multiple points are candidates for the next incident point, the correct point needs to be determined.</p>

<p>The points will be compared to the $xy$ of the mirror intersection, $g(x,y)$, using the following conditions.</p>

<p>$\begin{align}
P_{x}^2 + P_{y}^2 &lt; x^2 + y^2&amp;\Rightarrow \text{point is within mirrors}<br>
P_{z} &gt; g(x,y)&amp;\Rightarrow \text{reflection goes to top mirror}<br>
P_{z} &lt; g(x,y)&amp;\Rightarrow \text{reflection goes to bottom mirror}
\end{align}\tag{37}$</p>

<!-- The above conditions are true if the reflected beam is coming from the bottom mirror, similar conditions can be written for a beam coming from the top mirror. -->

<h2 id="underlinetextcalculating-multiple-reflections-for-a-single-starting-point">$\underline{\text{Calculating multiple reflections for a single starting point}.}$</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Inew</span> <span class="o">=</span> <span class="n">I</span>
<span class="n">Nnew</span> <span class="o">=</span> <span class="nf">parabolic_surf_normal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">)</span>
<span class="n">Rnew</span> <span class="o">=</span> <span class="nf">reflection_vector</span><span class="p">(</span><span class="n">Nnew</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>

<span class="n">Pnew</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="nf">parabolic_surf</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)[</span><span class="sh">'</span><span class="s">bottom mirror</span><span class="sh">'</span><span class="p">]])</span>
<span class="n">num_reflections</span> <span class="o">=</span> <span class="mi">11</span>

<span class="n">incident_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">([</span><span class="n">num_reflections</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">reflection_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">([</span><span class="n">num_reflections</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
<span class="n">normal_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">([</span><span class="n">num_reflections</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

<span class="n">incident_points</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">([</span><span class="n">num_reflections</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">tqdm</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="n">num_reflections</span><span class="p">),</span> <span class="n">desc</span><span class="o">=</span><span class="sh">"</span><span class="s">Calculating Reflections...</span><span class="sh">"</span><span class="p">):</span>
  <span class="n">incident_vectors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>   <span class="o">=</span> <span class="n">Inew</span>
  <span class="n">reflection_vectors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rnew</span>
  <span class="n">normal_vectors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>     <span class="o">=</span> <span class="n">Nnew</span>
  <span class="n">incident_points</span> <span class="p">[</span><span class="n">i</span><span class="p">]</span>   <span class="o">=</span> <span class="n">Pnew</span>

  <span class="n">scale</span> <span class="o">=</span> <span class="nf">scale_factor</span><span class="p">(</span><span class="n">Rnew</span><span class="p">,</span><span class="n">Pnew</span><span class="p">,</span><span class="n">mirror_intersect_z</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
  <span class="n">candidate_points</span> <span class="o">=</span> <span class="nf">possible_points</span><span class="p">(</span><span class="n">Pnew</span><span class="p">,</span><span class="n">scale</span><span class="p">,</span><span class="n">Rnew</span><span class="p">)</span>
  <span class="n">Pnew</span> <span class="o">=</span> <span class="nf">next_point_select</span><span class="p">(</span><span class="n">candidate_points</span><span class="p">,</span> <span class="n">mirror_intersect_x</span><span class="p">,</span> <span class="n">mirror_intersect_y</span><span class="p">,</span> <span class="n">mirror_intersect_z</span><span class="p">)</span>

  <span class="n">Inew</span> <span class="o">=</span> <span class="o">-</span><span class="n">Rnew</span>
  <span class="k">if</span> <span class="n">Pnew</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mirror_intersect_z</span><span class="p">.</span><span class="nf">mean</span><span class="p">():</span>
    <span class="n">Nnew</span> <span class="o">=</span> <span class="nf">parabolic_surf_normal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">Pnew</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Pnew</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">Nnew</span> <span class="o">=</span> <span class="nf">parabolic_surf_normal</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">Pnew</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Pnew</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

  <span class="n">Rnew</span> <span class="o">=</span> <span class="nf">reflection_vector</span><span class="p">(</span><span class="n">Nnew</span><span class="p">,</span><span class="n">Inew</span><span class="p">)</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Calculating Reflections...: 100%|██████████| 11/11 [00:00&lt;00:00, 1899.75it/s]
</code></pre></div></div>

<h2 id="underlinetextplotting-trajectories">$\underline{\text{Plotting Trajectories}}$</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="sh">'</span><span class="s">3d</span><span class="sh">'</span><span class="p">)</span>

<span class="n">ax</span><span class="p">.</span><span class="nf">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tm_surf</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">viridis_r</span><span class="sh">'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="sh">'</span><span class="s">none</span><span class="sh">'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bm_surf</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">viridis</span><span class="sh">'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="sh">'</span><span class="s">none</span><span class="sh">'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot3D</span><span class="p">(</span><span class="n">mirror_intersect_x</span><span class="p">,</span><span class="n">mirror_intersect_y</span><span class="p">,</span><span class="n">mirror_intersect_z</span> <span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">purple</span><span class="sh">'</span><span class="p">)</span>

<span class="c1"># ax.quiver(incident_points[:,0], incident_points[:,1], incident_points[:,2],
#           incident_vectors[:,0], incident_vectors[:,1], incident_vectors[:,2], length=0.5, normalize=True, color = 'red')
# ax.quiver(incident_points[:,0], incident_points[:,1], incident_points[:,2],
#           normal_vectors[:,0], normal_vectors[:,1], normal_vectors[:,2], length=0.5, normalize=True, color = 'black')
# ax.quiver(incident_points[:,0], incident_points[:,1], incident_points[:,2],
#           reflection_vectors[:,0], reflection_vectors[:,1], reflection_vectors[:,2], length=0.5, normalize=True, color = 'blue')
</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">quiver</span><span class="p">(</span><span class="n">incident_points</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">incident_points</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">incident_points</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
          <span class="n">incident_vectors</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">incident_vectors</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">incident_vectors</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">length</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">quiver</span><span class="p">(</span><span class="n">incident_points</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">incident_points</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">incident_points</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
          <span class="n">normal_vectors</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">normal_vectors</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">normal_vectors</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">length</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">quiver</span><span class="p">(</span><span class="n">incident_points</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">incident_points</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">incident_points</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
          <span class="n">reflection_vectors</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">reflection_vectors</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">reflection_vectors</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">length</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">)</span>

<span class="n">ax</span><span class="p">.</span><span class="nf">plot3D</span><span class="p">(</span><span class="n">incident_points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">incident_points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">incident_points</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="sh">'</span><span class="s">k*</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot3D</span><span class="p">(</span><span class="n">incident_points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">incident_points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">incident_points</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="sh">'</span><span class="s">k--</span><span class="sh">'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">axis</span><span class="p">(</span><span class="sh">'</span><span class="s">equal</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_zlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">z</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_proj_type</span><span class="p">(</span><span class="sh">'</span><span class="s">ortho</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">azim</span><span class="o">=</span> <span class="mi">130</span><span class="p">)</span>
<span class="c1"># ax.view_init(elev= 90.0, azim= -90)
</span><span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Mirror surfaces and beam trajectories</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<p><img src="ParabolicMirrorSim_v2_files/ParabolicMirrorSim_v2_34_0.png" alt="png"></p>

<h2 id="underlinetextcalculating-multiple-reflections-for-a-several-starting-point">$\underline{\text{Calculating multiple reflections for a several starting point}.}$</h2>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">X0</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="nf">pow</span><span class="p">(</span><span class="mf">0.81</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="nf">pow</span><span class="p">(</span><span class="n">X0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>

<span class="n">X0</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">([</span><span class="n">X0</span><span class="p">,</span> <span class="n">X0</span><span class="p">])</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">([</span><span class="n">Y0</span><span class="p">,</span><span class="o">-</span><span class="n">Y0</span><span class="p">])</span>

<span class="n">X0</span> <span class="o">=</span> <span class="n">X0</span><span class="p">.</span><span class="nf">reshape</span><span class="p">([</span><span class="nf">len</span><span class="p">(</span><span class="n">X0</span><span class="p">),</span><span class="mi">1</span><span class="p">])</span>
<span class="n">Y0</span> <span class="o">=</span> <span class="n">Y0</span><span class="p">.</span><span class="nf">reshape</span><span class="p">([</span><span class="nf">len</span><span class="p">(</span><span class="n">Y0</span><span class="p">),</span><span class="mi">1</span><span class="p">])</span>

<span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">concatenate</span><span class="p">([</span><span class="n">X0</span><span class="p">,</span><span class="n">Y0</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">num_reflections</span> <span class="o">=</span> <span class="mi">6</span>
</code></pre></div></div>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="p">.</span><span class="nf">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="sh">'</span><span class="s">3d</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">tm_surf</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">viridis_r</span><span class="sh">'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="sh">'</span><span class="s">none</span><span class="sh">'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot_surface</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">bm_surf</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="sh">'</span><span class="s">viridis</span><span class="sh">'</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="sh">'</span><span class="s">none</span><span class="sh">'</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">plot3D</span><span class="p">(</span><span class="n">mirror_intersect_x</span><span class="p">,</span><span class="n">mirror_intersect_y</span><span class="p">,</span><span class="n">mirror_intersect_z</span> <span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="sh">'</span><span class="s">purple</span><span class="sh">'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nf">tqdm</span><span class="p">(</span><span class="nf">range</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">XY</span><span class="p">)),</span> <span class="n">desc</span><span class="o">=</span><span class="sh">"</span><span class="s">Calculating Reflections...</span><span class="sh">"</span><span class="p">):</span>
  <span class="n">Inew</span> <span class="o">=</span> <span class="n">I</span>
  <span class="n">Nnew</span> <span class="o">=</span> <span class="nf">parabolic_surf_normal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">XY</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">XY</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">Rnew</span> <span class="o">=</span> <span class="nf">reflection_vector</span><span class="p">(</span><span class="n">Nnew</span><span class="p">,</span><span class="n">I</span><span class="p">)</span>
  <span class="n">Pnew</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">array</span><span class="p">([</span><span class="n">XY</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">XY</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="nf">parabolic_surf</span><span class="p">(</span><span class="n">XY</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">XY</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">d</span><span class="p">)[</span><span class="sh">'</span><span class="s">bottom mirror</span><span class="sh">'</span><span class="p">]])</span>

  <span class="n">incident_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">([</span><span class="n">num_reflections</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
  <span class="n">reflection_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">([</span><span class="n">num_reflections</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
  <span class="n">normal_vectors</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">([</span><span class="n">num_reflections</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>
  <span class="n">incident_points</span> <span class="o">=</span> <span class="n">np</span><span class="p">.</span><span class="nf">zeros</span><span class="p">([</span><span class="n">num_reflections</span><span class="p">,</span><span class="mi">3</span><span class="p">])</span>

  <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nf">range</span><span class="p">(</span><span class="n">num_reflections</span><span class="p">):</span> <span class="c1">#tqdm(range(num_reflections), desc="Calculating Reflections..."):
</span>    <span class="n">incident_vectors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Inew</span>
    <span class="n">reflection_vectors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Rnew</span>
    <span class="n">normal_vectors</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Nnew</span>
    <span class="n">incident_points</span> <span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Pnew</span>

    <span class="n">scale</span> <span class="o">=</span> <span class="nf">scale_factor</span><span class="p">(</span><span class="n">Rnew</span><span class="p">,</span><span class="n">Pnew</span><span class="p">,</span><span class="n">mirror_intersect_z</span><span class="p">.</span><span class="nf">mean</span><span class="p">(),</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">d</span><span class="p">)</span>
    <span class="n">candidate_points</span> <span class="o">=</span> <span class="nf">possible_points</span><span class="p">(</span><span class="n">Pnew</span><span class="p">,</span><span class="n">scale</span><span class="p">,</span><span class="n">Rnew</span><span class="p">)</span>
    <span class="n">Pnew</span> <span class="o">=</span> <span class="nf">next_point_select</span><span class="p">(</span><span class="n">candidate_points</span><span class="p">,</span><span class="n">mirror_intersect_x</span><span class="p">,</span><span class="n">mirror_intersect_y</span><span class="p">,</span><span class="n">mirror_intersect_z</span><span class="p">)</span>

    <span class="n">Inew</span> <span class="o">=</span> <span class="o">-</span><span class="n">Rnew</span>
    <span class="k">if</span> <span class="n">Pnew</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mirror_intersect_z</span><span class="p">.</span><span class="nf">mean</span><span class="p">():</span>
      <span class="n">Nnew</span> <span class="o">=</span> <span class="nf">parabolic_surf_normal</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">Pnew</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Pnew</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">Nnew</span> <span class="o">=</span> <span class="nf">parabolic_surf_normal</span><span class="p">(</span><span class="o">-</span><span class="n">a</span><span class="p">,</span><span class="o">-</span><span class="n">b</span><span class="p">,</span><span class="n">Pnew</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Pnew</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">Rnew</span> <span class="o">=</span> <span class="nf">reflection_vector</span><span class="p">(</span><span class="n">Nnew</span><span class="p">,</span><span class="n">Inew</span><span class="p">)</span>

  <span class="n">ax</span><span class="p">.</span><span class="nf">quiver</span><span class="p">(</span><span class="n">incident_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">incident_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">incident_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">incident_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">incident_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">incident_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">length</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="sh">'</span><span class="s">red</span><span class="sh">'</span><span class="p">)</span>
  <span class="n">ax</span><span class="p">.</span><span class="nf">quiver</span><span class="p">(</span><span class="n">incident_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">incident_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">incident_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">normal_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">normal_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">normal_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">length</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">)</span>
  <span class="n">ax</span><span class="p">.</span><span class="nf">quiver</span><span class="p">(</span><span class="n">incident_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">incident_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">incident_points</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">reflection_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">reflection_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">reflection_vectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>
            <span class="n">length</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="sh">'</span><span class="s">blue</span><span class="sh">'</span><span class="p">)</span>

  <span class="n">ax</span><span class="p">.</span><span class="nf">plot3D</span><span class="p">(</span><span class="n">incident_points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">incident_points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">incident_points</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="sh">'</span><span class="s">k*</span><span class="sh">'</span><span class="p">)</span>
  <span class="n">ax</span><span class="p">.</span><span class="nf">plot3D</span><span class="p">(</span><span class="n">incident_points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span><span class="n">incident_points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">incident_points</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span><span class="sh">'</span><span class="s">k--</span><span class="sh">'</span><span class="p">)</span>

<span class="n">plt</span><span class="p">.</span><span class="nf">axis</span><span class="p">(</span><span class="sh">'</span><span class="s">equal</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">xlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">x</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">ylabel</span><span class="p">(</span><span class="sh">'</span><span class="s">y</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_zlabel</span><span class="p">(</span><span class="sh">'</span><span class="s">z</span><span class="sh">'</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_zlim</span><span class="p">(</span><span class="n">bottom</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="p">.</span><span class="nf">set_proj_type</span><span class="p">(</span><span class="sh">'</span><span class="s">ortho</span><span class="sh">'</span><span class="p">)</span>
<span class="c1"># ax.view_init(elev=0, azim=-90.0)
</span><span class="n">plt</span><span class="p">.</span><span class="nf">title</span><span class="p">(</span><span class="sh">'</span><span class="s">Mirror surfaces and beam trajectories</span><span class="sh">'</span><span class="p">)</span>
<span class="n">plt</span><span class="p">.</span><span class="nf">show</span><span class="p">()</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Calculating Reflections...: 100%|██████████| 4/4 [00:00&lt;00:00, 76.85it/s]
</code></pre></div></div>

<p><img src="ParabolicMirrorSim_v2_files/ParabolicMirrorSim_v2_37_1.png" alt="png"></p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
</code></pre></div></div>

          </article>

        </div>

      
    </div>

    <!-- Footer -->    
    <footer class="fixed-bottom">
      <div class="container mt-0">
        © Copyright 2024 Thomas Samir Bsaibes. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>.

      </div>
    </footer>

    <!-- JavaScripts -->
    <!-- jQuery -->
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <!-- Bootsrap & MDB scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script>

    <!-- Masonry & imagesLoaded -->
  <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script>
  <script defer src="/assets/js/masonry.js" type="text/javascript"></script>
    
  <!-- Medium Zoom JS -->
  <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script defer src="/assets/js/zoom.js"></script>

  <!-- Bootstrap Table -->
  <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script>

  <!-- Load Common JS -->
  <script src="/assets/js/no_defer.js"></script>
  <script defer src="/assets/js/common.js"></script>
  <script defer src="/assets/js/copy_code.js" type="text/javascript"></script>

    
  <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script>
  <script async src="https://badge.dimensions.ai/badge.js"></script>

    <!-- MathJax -->
  <script type="text/javascript">
    window.MathJax = {
      tex: {
        tags: 'ams'
      }
    };
  </script>
  <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script>
  <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>

    
    

<!-- Scrolling Progress Bar -->
<script type="text/javascript">
  /*
   * This JavaScript code has been adapted from the article 
   * https://css-tricks.com/reading-position-indicator/ authored by Pankaj Parashar, 
   * published on the website https://css-tricks.com on the 7th of May, 2014.
   * Couple of changes were made to the original code to make it compatible 
   * with the `al-foio` theme.
   */
  const progressBar = $("#progress");
  /*
   * We set up the bar after all elements are done loading.
   * In some cases, if the images in the page are larger than the intended
   * size they'll have on the page, they'll be resized via CSS to accomodate
   * the desired size. This mistake, however, breaks the computations as the
   * scroll size is computed as soon as the elements finish loading.
   * To account for this, a minimal delay was introduced before computing the
   * values.
   */
  window.onload = function () {
    setTimeout(progressBarSetup, 50);
  };
  /*
   * We set up the bar according to the browser.
   * If the browser supports the progress element we use that.
   * Otherwise, we resize the bar thru CSS styling
   */
  function progressBarSetup() {
    if ("max" in document.createElement("progress")) {
      initializeProgressElement();
      $(document).on("scroll", function() {
        progressBar.attr({ value: getCurrentScrollPosition() });
      });
      $(window).on("resize", initializeProgressElement);
    } else {
      resizeProgressBar();
      $(document).on("scroll", resizeProgressBar);
      $(window).on("resize", resizeProgressBar);
    }
  }
  /*
   * The vertical scroll position is the same as the number of pixels that
   * are hidden from view above the scrollable area. Thus, a value > 0 is
   * how much the user has scrolled from the top
   */
  function getCurrentScrollPosition() {
    return $(window).scrollTop();
  }

  function initializeProgressElement() {
    let navbarHeight = $("#navbar").outerHeight(true);
    $("body").css({ "padding-top": navbarHeight });
    $("progress-container").css({ "padding-top": navbarHeight });
    progressBar.css({ top: navbarHeight });
    progressBar.attr({
      max: getDistanceToScroll(),
      value: getCurrentScrollPosition(),
    });
  }
  /*
   * The offset between the html document height and the browser viewport
   * height will be greater than zero if vertical scroll is possible.
   * This is the distance the user can scroll
   */
  function getDistanceToScroll() {
    return $(document).height() - $(window).height();
  }

  function resizeProgressBar() {
    progressBar.css({ width: getWidthPercentage() + "%" });
  }
  // The scroll ratio equals the percentage to resize the bar
  function getWidthPercentage() {
    return (getCurrentScrollPosition() / getDistanceToScroll()) * 100;
  }
</script>

  </body>
</html>
